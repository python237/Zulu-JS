!function(t,e){"use strict";if(void 0===t||!1 in t||!1 in t.factory||t.isZulu!==t.factory.type)throw new Error("Zulu Toolkit requires");if(!t.factory.requires("1.0.0"))throw new Error("zulu ajax extension requires V1.0.0");const r={launchCallback:function(t,e){if("object"==typeof t)for(let r=0;r<t.length;r++)t[r](e);else t(e)},checkCallback:function(t){if("function"==typeof t)return t;if("object"==typeof t){for(let e=0;e<t.length;e++)this.checkCallback(t[e]);return t}throw new Error("callback requires function or list functions")}};function i(l){this.xhr=void 0,this.url=l,this.type="json",this.credentials=!0,this.mimeType="text/json",this.timeout=3e5,this.responseCallback=function(){},this.oldNavigatorCallback=function(){},this.collisionCallback=function(){},this.serverErrorCallback=function(){},this.requestBeginCallback=function(){},this.requestEndCallback=function(){},this.downloadProgressCallback=function(){},this.timeoutExceptionCallback=function(){},this.requestErrorCallback=function(){},this.requestAbortCallback=function(){},this.requestHeaders={},this.allowAllOrigin=!1;let a=!1,o=!1,s=void 0;const n=this;if(i.prototype.valueOf={},i.prototype.isZulu="Zulu XHR Object",i.prototype.running=function(){return o},i.prototype.setCredentials=function(t){return this.credentials=t,this},i.prototype.setType=function(t,e){return this.type=t,this.mimeType=e,this},i.prototype.setTimeout=function(t){return this.timeout=t,this},i.prototype.setRequestHeaders=function(t){this.requestHeaders=t},i.prototype.start=function(i){if(void 0===i.method)throw new Error("method request requires");this.responseCallback=r.checkCallback(i.response||this.responseCallback),this.oldNavigatorCallback=r.checkCallback(i.oldNavigator||this.oldNavigatorCallback),this.collisionCallback=r.checkCallback(i.collision||this.collisionCallback),this.serverErrorCallback=r.checkCallback(i.serverError||this.serverErrorCallback),this.requestBeginCallback=r.checkCallback(i.requestBegin||this.requestBeginCallback),this.requestEndCallback=r.checkCallback(i.requestEnd||this.requestEndCallback),this.downloadProgressCallback=r.checkCallback(i.downloadProgress||this.downloadProgressCallback),this.timeoutExceptionCallback=r.checkCallback(i.timeoutException||this.timeoutExceptionCallback),this.requestErrorCallback=r.checkCallback(i.requestError||this.requestErrorCallback),this.requestAbortCallback=r.checkCallback(i.requestAbort||this.requestAbortCallback),this.credentials=i.credentials||this.credentials,this.type=i.type||this.type,this.mimeType=i.mimeType||this.mimeType,this.timeout=i.timeout||this.timeout,this.requestHeaders=i.headers||this.requestHeaders,this.allowAllOrigin=i.allowAllOrigin||this.allowAllOrigin;const l=i.authenticate||!1;if(a)r.launchCallback(this.oldNavigatorCallback);else if(o)r.launchCallback(this.collisionCallback,i);else{let r;for(r in s=""+(i.data||""),this.xhr.open(i.method,this.url,!0),this.xhr.withCredentials=this.credentials,this.xhr.overrideMimeType(this.mimeType),this.xhr.timeout=this.timeout,this.requestHeaders)this.xhr.setRequestHeader(r,this.requestHeaders[r]);if(this.allowAllOrigin&&this.xhr.setRequestHeader("Access-Control-Allow-Origin","*"),"POST"===i.method){const a=i.data||[];let o=null;if(void 0!==a&&null!=typeof a)if(a.isZulu===t.factory.type)o=new FormData(a.node);else for(o=new FormData,r=0;r<a.length;r++){if("object"!=typeof a[r])throw new Error("data array error");o.append(a[r][0],a[r][1])}if(l){const t=e("input[name=csrfmiddlewaretoken][type=hidden]");void 0!==t&&(null!=o?o.append("csrfmiddlewaretoken",t.take(0).attr("value",void 0)||""):(o=new FormData).append("csrfmiddlewaretoken",t.take(0).attr("value",void 0)||""))}this.xhr.send(o)}else this.xhr.send(null)}return this},i.prototype.post=function(t){return t.method="POST",this.start(t)},i.prototype.get=function(t){return t.method="GET",this.start(t)},i.prototype.abort=function(){return this.xhr.abort(),this},i.prototype.setResponseCallback=function(t){return this.responseCallback=r.checkCallback(t),this},i.prototype.setOldNavigatorCallback=function(t){return this.oldNavigatorCallback=r.checkCallback(t),this},i.prototype.setCollisionCallback=function(t){return this.collisionCallback=r.checkCallback(t),this},i.prototype.setServerErrorCallback=function(t){return this.serverErrorCallback=r.checkCallback(t),this},i.prototype.setRequestBeginCallback=function(t){return this.requestBeginCallback=r.checkCallback(t),this},i.prototype.setRequestEndCallback=function(t){return this.requestEndCallback=r.checkCallback(t),this},i.prototype.setDownloadProgressCallback=function(t){return this.downloadProgressCallback=r.checkCallback(t),this},i.prototype.setTimeoutExceptionCallback=function(t){return this.timeoutExceptionCallback=r.checkCallback(t),this},i.prototype.setRequestErrorCallback=function(t){return this.requestErrorCallback=r.checkCallback(t),this},i.prototype.setRequestAbortCallback=function(t){return this.requestAbortCallback=r.checkCallback(t),this},window.XMLHttpRequest)this.xhr=new XMLHttpRequest;else if(window.ActiveXObject)try{if(this.xhr=new ActiveXObject("Msxml2.XMLHTTP"),void 0===this.xhr||null===this.xhr)throw new Error}catch(t){try{this.xhr=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){a=!0}}void 0===this.xhr||null===this.xhr?a=!0:(this.xhr.onabort=function(){r.launchCallback(n.requestAbortCallback),o=!1},this.xhr.onerror=function(){r.launchCallback(n.requestErrorCallback),o=!1},this.xhr.ontimeout=function(){r.launchCallback(n.timeoutExceptionCallback),o=!1},this.xhr.onprogress=function(t){r.launchCallback(n.downloadProgressCallback,t)},this.xhr.onloadstart=function(){r.launchCallback(n.requestBeginCallback),o=!0},this.xhr.onreadystatechange=function(){if(4===n.xhr.readyState){if(200===n.xhr.status){let t=void 0;t="xml"===n.type?n.xhr.responseXML:"json"===n.type?JSON.parse(n.xhr.responseText):n.xhr.responseText,r.launchCallback(n.responseCallback,t)}else 301!==n.xhr.status&&302!==n.xhr.status&&r.launchCallback(n.serverErrorCallback,n.xhr.status);r.launchCallback(n.requestEndCallback),o=!1}})}t.prototype.xhr=function(t){if(void 0===t||"string"!=typeof t.valueOf())throw new Error("url requires");return new i(t)},t.factory.extensions.xhr=i}(function(t){return void 0!==t&&t.isZulu?t:void 0}(ux||window.ux),function(t){if(void 0!==t&&"function"==typeof t)return t;throw new Error("Requires zulu")}(z||window.zulu));
